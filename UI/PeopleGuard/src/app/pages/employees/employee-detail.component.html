<div class="employee-detail-container">
  <div class="header">
    <button class="btn btn-back" (click)="goBack()">← Back</button>
    <div class="title-stack" *ngIf="employee">
      <h2>{{ employee.name }}</h2>
      <p class="employee-id">{{ employee.employeeId }} • {{ employee.department }} • {{ employee.factory }}</p>
    </div>
  </div>

  <div *ngIf="loading" class="loading-state">Loading employee...</div>
  <div *ngIf="error" class="error-state">{{ error }}</div>

  <div *ngIf="!loading && employee" class="content">
    <section class="info-card">
      <h3>Employee</h3>
      <div class="info-grid">
        <div><label>ID</label><p>{{ employee.employeeId }}</p></div>
        <div><label>Email</label><p>{{ employee.email || 'N/A' }}</p></div>
        <div><label>Phone</label><p>{{ employee.phone || 'N/A' }}</p></div>
        <div><label>Department</label><p>{{ employee.department }}</p></div>
        <div><label>Factory</label><p>{{ employee.factory }}</p></div>
        <div><label>Position</label><p>{{ employee.designation || 'N/A' }}</p></div>
      </div>
    </section>

    <section class="stats-card" *ngIf="stats">
      <h3>Stats</h3>
      <div class="stats-grid">
        <div class="stat"><span>{{ stats.totalCases }}</span><label>Total Cases</label></div>
        <div class="stat"><span>{{ stats.open }}</span><label>Open</label></div>
        <div class="stat"><span>{{ stats.closed }}</span><label>Closed</label></div>
        <div class="stat"><span>{{ stats.verbalWarnings }}</span><label>Verbal Warnings</label></div>
        <div class="stat"><span>{{ stats.writtenWarnings }}</span><label>Written Warnings</label></div>
      </div>
    </section>

    <section class="history-card">
      <div class="history-header">
        <div>
          <h3>History</h3>
          <p>Investigations and warning letters</p>
        </div>
        <div class="history-actions">
          <select [(ngModel)]="filters.type" (change)="onFilterChange()">
            <option value="all">All</option>
            <option value="investigation">Investigations</option>
            <option value="warning">Warnings</option>
          </select>
          <input type="date" [(ngModel)]="filters.from" (change)="onFilterChange()">
          <input type="date" [(ngModel)]="filters.to" (change)="onFilterChange()">
          <button class="btn btn-outline" (click)="exportCsv()">Export CSV</button>
        </div>
      </div>

      <div *ngIf="loadingHistory" class="loading-state">Loading history...</div>
      <div *ngIf="!loadingHistory && history?.data?.length === 0" class="empty-state">No history found</div>

      <table *ngIf="!loadingHistory && history?.data?.length">
        <thead>
          <tr>
            <th>Type</th>
            <th>Title</th>
            <th>Case Type</th>
            <th>Status</th>
            <th>Outcome</th>
            <th>Date</th>
            <th>Description</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of history?.data">
            <td>{{ row.kind }}</td>
            <td>{{ row.title }}</td>
            <td>{{ row.caseType }}</td>
            <td>{{ row.status }}</td>
            <td>{{ row.outcome || '—' }}</td>
            <td>{{ row.date | date:'yyyy-MM-dd' }}</td>
            <td>{{ row.description || '—' }}</td>
            <td>
              <button class="link" (click)="navigateToInvestigation(row.investigationId)">View</button>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="pager" *ngIf="history?.total">
        <button class="btn btn-outline" (click)="onPageChange(-1)" [disabled]="page === 1">Prev</button>
        <span>Page {{ page }} of {{ history ? Math.ceil(history.total / history.size) : 1 }}</span>
        <button class="btn btn-outline" (click)="onPageChange(1)" [disabled]="history && page >= Math.ceil(history.total / history.size)">Next</button>
      </div>
    </section>
  </div>
</div>

