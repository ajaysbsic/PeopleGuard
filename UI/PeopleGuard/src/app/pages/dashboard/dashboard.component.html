<div class="dashboard-container">
  <div class="header">
    <h2>Dashboard</h2>
    <div class="filters">
      <label>Group by
        <select [(ngModel)]="groupBy" (change)="onGroupChange(groupBy)">
          <option value="factory">Factory</option>
          <option value="department">Department</option>
          <option value="type">Case Type</option>
        </select>
      </label>
      <label>From <input type="date" [(ngModel)]="dateFrom" (change)="onDateChange()"></label>
      <label>To <input type="date" [(ngModel)]="dateTo" (change)="onDateChange()"></label>
    </div>
  </div>

  <div *ngIf="loading" class="loading">Loading...</div>
  
  <div *ngIf="!loading && data" class="dashboard-content">
    <!-- Hero Banner -->
    <div class="hero-banner">
      <img src="assets/images/alf_dashboard.jpg" alt="Dashboard Banner" loading="lazy">
    </div>

    <!-- Charts Row -->
    <div class="charts-row">
      <div class="chart-card" (click)="drillToCases(String(barChartData?.labels?.[0] || ''))">
        <canvas baseChart *ngIf="barChartData"
          [data]="barChartData"
          [options]="barChartOptions"
          type="bar">
        </canvas>
      </div>
      
      <div class="chart-card">
        <canvas baseChart *ngIf="pieChartData"
          [data]="pieChartData"
          [options]="pieChartOptions"
          type="pie"
          (chartClick)="onPieChartClick($event)">
        </canvas>
      </div>
    </div>

    <div class="charts-row">
      <div class="chart-card wide">
        <canvas baseChart *ngIf="lineChartData"
          [data]="lineChartData"
          [options]="lineChartOptions"
          type="line">
        </canvas>
      </div>
    </div>

    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="card">
        <h3>Total Employees</h3>
        <p class="big-number">{{data.totalEmployees}}</p>
      </div>
      <div class="card">
        <h3>Active Investigations</h3>
        <p class="big-number">{{data.activeInvestigations}}</p>
      </div>
      <div class="card">
        <h3>Total Violations</h3>
        <p class="big-number">{{data.totalViolations}}</p>
      </div>
      <div class="card">
        <h3>Pending Warnings</h3>
        <p class="big-number">{{data.pendingWarnings}}</p>
      </div>
    </div>

    <!-- Top Violators -->
    <div class="top-violators">
      <h3>Top Violators</h3>
      <table>
        <thead>
          <tr>
            <th>Employee</th>
            <th>Count</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let v of data.topViolators">
            <td>{{v.employeeName}}</td>
            <td>{{v.count}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
